<!DOCTYPE html>
<html dir="rtl" lang="ar">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Roblox | متجر قصي</title>
  <link rel="icon" href="emp.png" type="image/png">

  <!-- منع الدخول المباشر: يعيد إلى الرئيسية إن لم تكن الملاحة من الداخل -->
  <script>
    (function(){
      try{
        var nav = (performance.getEntriesByType && performance.getEntriesByType('navigation')) || [];
        var type = nav[0] ? nav[0].type : (performance.navigation ? (performance.navigation.type === 1 ? 'reload' : (performance.navigation.type === 2 ? 'back_forward' : '')) : '');
        var isReload = type === 'reload';
        var isBF = type === 'back_forward';
        var refOk = false; try { var r=document.referrer; if (r) { var u=new URL(r); refOk = (u.origin === location.origin); } } catch(e){}
        var paramsAllow = false; try { paramsAllow = (new URLSearchParams(location.search)).has('allow'); } catch(e){}
        var guardOff = false; try { guardOff = localStorage.getItem('nav:guardOff') === '1'; } catch(e){}
        var ok = sessionStorage.getItem('nav:fromHome') === '1';
        if (!ok && !isReload && !isBF && !refOk && !paramsAllow && !guardOff) {
          sessionStorage.setItem('nav:redirectedFrom', location.pathname.split('/').pop());
          window.location.replace('index.html');
        } else if (ok) {
          sessionStorage.removeItem('nav:fromHome');
        }
      }catch(e){ window.location.replace('index.html'); }
    })();
  </script>

  <!-- تهيئة الثيم مبكرًا وتعيين color-scheme -->
  <script>
    (function(){
      var theme='dark';
      try{var t=localStorage.getItem('theme'); if(!t){t=(window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches)?'dark':'light';} theme=(t==='light')?'light':'dark';}catch(e){theme='dark';}
      document.documentElement.setAttribute('data-theme', theme);
      try{
        var cs=document.querySelector('meta[name="color-scheme"]'); if(!cs){cs=document.createElement('meta'); cs.name='color-scheme'; document.head.appendChild(cs);} cs.setAttribute('content', theme==='dark'?'dark light':'light dark');
        var tc=document.querySelector('meta[name="theme-color"]'); if(!tc){tc=document.createElement('meta'); tc.name='theme-color'; document.head.appendChild(tc);} tc.setAttribute('content', theme==='dark'?'#0b1220':'#f9f9f9');
      }catch(e){}
      var s=document.createElement('style'); s.id='critical-theme'; s.textContent='html{background:'+(theme==='dark'?'#0b1220':'#f9f9f9')+';color:'+(theme==='dark'?'#e6edf3':'#333')+'} body{background:inherit;color:inherit;margin:0}'; document.head.appendChild(s);
    })();
  </script>
  <meta name="color-scheme" content="dark light">
  <meta name="theme-color" content="#0b1220">

  <!-- تحسين الاتصال المسبق -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://m.media-amazon.com" crossorigin>
  <link rel="preconnect" href="https://i.ibb.co" crossorigin>
  <link rel="preconnect" href="https://qusaishopjawaker.qusaishop1.workers.dev" crossorigin>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    
    <script>
  (function(){
    function applyCardState(card, state){
      var finalState = (state == null) ? 'on' : state;
      var titleEl = card.querySelector ? card.querySelector('h2') : null;
      var img = card.querySelector ? card.querySelector('img') : null;
      try{ card.classList.remove('loading'); }catch(_){ }
      if (finalState === 'off'){
        if (img){ try{ img.setAttribute('loading','eager'); img.setAttribute('decoding','sync'); img.setAttribute('fetchpriority','high'); }catch(_){ } }
        try{ card.classList.add('maintenance'); card.classList.remove('pending-state'); }catch(_){ }
        try{ card.removeAttribute('href'); }catch(_){ }
        if (titleEl){ try{ titleEl.textContent = '🚧 مغلق للصيانة'; }catch(_){ } }
      } else {
        try{
          if (card.dataset && card.dataset.originalHref){ card.setAttribute('href', card.dataset.originalHref); }
          card.classList.remove('maintenance','pending-state');
          if (titleEl && card.dataset && card.dataset.originalTitle){ titleEl.textContent = card.dataset.originalTitle; }
        }catch(_){ }
      }
    }
    function prepCard(card){
      try{
        if (!card.dataset.originalHref){ var href = card.getAttribute('href'); if (href) card.dataset.originalHref = href; }
        var t = card.querySelector && card.querySelector('h2');
        if (t && !card.dataset.originalTitle){ card.dataset.originalTitle = t.textContent || ''; }
      }catch(_){ }
    }
    function getPageNameFromCard(card){
      try{
        var href = (card.dataset && card.dataset.originalHref) || card.getAttribute('href') || '';
        href = href.split('?')[0].split('#')[0];
        return href.replace(/\.html$/,'');
      }catch(_){ return ''; }
    }
    var STATES_TTL_MS = 5*60*1000;
    var STATES_CACHE_KEY = 'statesCache';
    function saveStatesCache(map){ try{ localStorage.setItem(STATES_CACHE_KEY, JSON.stringify({ savedAt: Date.now(), map: map||{} })); }catch(_){ } }
    function readStatesCache(ignoreTTL){
      try{
        var raw = localStorage.getItem(STATES_CACHE_KEY);
        if(!raw) return null;
        var obj; try{ obj = JSON.parse(raw); }catch(_){ obj=null; }
        if (obj && typeof obj === 'object'){
          if(!ignoreTTL){ var now = Date.now(); if(obj.savedAt && (now-obj.savedAt)>STATES_TTL_MS){ /* expired */ } }
          if (obj.map && typeof obj.map === 'object') return obj.map;
          if (typeof obj.stateJson === 'string'){ try{ var m=JSON.parse(obj.stateJson); if(m && typeof m==='object') return m; }catch(_){ } }
          var vals = Object.values(obj); if (vals.length && vals.every(function(v){return v==='on'||v==='off';})) return obj;
        }
        try{ var m2 = JSON.parse(raw); if (m2 && typeof m2==='object') return m2; }catch(_){ }
        return null;
      }catch(_){ return null; }
    }
    function parseStatesDoc(data){
      var map = {};
      try{
        if (typeof data.stateJson === 'string') { map = JSON.parse(data.stateJson)||{}; }
        else if (data.map && typeof data.map==='object'){ map = data.map; }
        else { map = data||{}; }
      }catch(_){ map = {}; }
      return map;
    }
    async function loadStatesMap(){
      try{
        if (typeof firebase==='undefined' || !firebase.firestore) return null;
        var ref = firebase.firestore().collection('config').doc('states');
        var snap = await ref.get({ source:'server' }).catch(function(){ return ref.get(); });
        if (!snap || !snap.exists) return null;
        var map = parseStatesDoc(snap.data()||{});
        saveStatesCache(map);
        return map;
      }catch(_){ return null; }
    }
    function applyStatesToPage(){
      try{
        var cards = Array.prototype.slice.call(document.querySelectorAll('a.card, .card[href]'));
        if (!cards.length) return;
        cards.forEach(prepCard);
        if (window.__SKIP_FIREBASE__){ try{ cards.forEach(function(card){ try{ card.removeAttribute('href'); card.classList.add('pending-state'); }catch(_){ } }); }catch(_){ } var cached = readStatesCache(true);
          if (cached){ cards.forEach(function(card){ var name=getPageNameFromCard(card); var s=(name && cached.hasOwnProperty(name))? cached[name] : 'on'; applyCardState(card,s); }); }
          return;
        }
        loadStatesMap().then(function(map){ if(!map){ map = readStatesCache(false)||{}; } cards.forEach(function(card){ var name=getPageNameFromCard(card); var s=(name && map && map.hasOwnProperty(name))? map[name] : 'on'; applyCardState(card,s); }); });
      }catch(_){ }
    }
    if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', applyStatesToPage); else try{ applyStatesToPage(); }catch(_){ }
  })();
  </script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <script src="script1roblox.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js" async></script>
  <link href="style1.css" rel="stylesheet"/>
  <link href="header.css" rel="stylesheet"/>
  <script defer src="header.js"></script>
  <script defer src="atff.js"></script>
  <script defer src="scriptroblox.js"></script>
  <link rel="stylesheet" href="loader.css">
<script src="loader.js" defer></script>
  <audio id="toast-success-sound" preload="none" src="success.mp3"></audio>
  <audio id="toast-error-sound" preload="none" src="error.mp3"></audio>
  <style>
    /* اتجاه عام مساعد */
    .rtl { direction: rtl; text-align: right; unicode-bidi: embed; }

    /* صندوق الملخص */
    #selected-amount-container {
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      text-align: center !important;
      margin:20px auto;max-width:400px;padding:20px;
      border:2px solid #007bff;border-radius:10px;background:#f9f9f9;font-weight:bold;
    }
    #selected-amount-container h2 { margin-bottom: 10px !important; }

    /* ✅ القسيمة RTL مع عزل الإنجليزية */
    #selected-amount-container .voucher{
      display:block !important;
      margin:0 auto !important;
      direction: rtl;
      text-align: right;
      unicode-bidi: isolate;
      font-weight: 700;
    }
    .voucher .line{ direction: rtl; text-align: right; margin: 10px 0; }
    .voucher .ltr{ direction: ltr; unicode-bidi: isolate; display:inline-block; white-space: nowrap; }
    .voucher .sep{ unicode-bidi: isolate; display:inline-block; padding: 0 .15rem; }
    .voucher .price{ white-space: nowrap; }

    /* البطاقات + تغطية "غير متوفر" */
    .offer-box { position: relative; cursor: pointer; }
    .offer-box.disabled { opacity: .4; cursor: not-allowed; }
    .offer-box .unavailable-badge{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.35); color:#fff; font-weight:700; border-radius:12px;
    }
  </style> </head>
 <body>
  <div id="headerContainer"></div>
  <div id="sidebarContainer"></div>

<div id="preloader">
  <div class="loader"></div>
</div>

  <!-- Toast (مرتين في ملفك الأصلي؛ نُبقي واحدًا فقط لتجنب التعارض) -->
  <div id="toast" style="
    visibility: hidden;
    min-width: 250px;
    margin-left: -125px;
    background-color: #323232;
    color: #fff;
    text-align: center;
    border-radius: 12px;
    padding: 16px;
    position: fixed;
    z-index: 9999;
    left: 50%;
    bottom: 30px;
    font-size: 16px;
    box-shadow: 0px 2px 10px rgba(0,0,0,0.2);
    transition: visibility 0s, opacity 0.5s ease-in-out;
    opacity: 0;">
    <span id="toast-message"></span>
  </div>

  <form id="orderForm" novalidate>
    <div class="container">

      <div id="top-banner">
        <div class="banner-layer" id="banner1"></div>
        <div class="banner-layer" id="banner2"></div>
      </div>

      <div class="player-id-box" style="
        max-width: 500px; margin: 20px auto; padding: 20px;
        border: 2px solid #007bff; border-radius: 10px; background-color: #f9f9f9;">
        <label for="player-id" style="font-size:16px; font-weight:bold; margin-bottom:10px; display:block;">
          معرف اللاعب 🎮
          <i onclick="openPopup()" style="color:#007bff; cursor: pointer;" title="معرف اللاعب داخل اللعبة">❓</i>
        </label>
        <div class="input-group" style="display:flex;">
          <input id="player-id" placeholder="أدخل معرف اللاعب هنا"
                 style="flex:1; padding:12px; font-size:16px; border:1px solid #ccc; border-radius:8px 0 0 8px;" type="text" />
        </div>
      </div>

      <!-- النافذة المنبثقة -->
      <div id="popup" onclick="closePopupOnOutsideClick(event)"
           style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; justify-content:center; align-items:center;">
        <div onclick="event.stopPropagation()" style="position:relative; background:white; padding:10px; border-radius:10px; max-width:90%; max-height:90%;">
          <span onclick="closePopup()" style="position:absolute; top:5px; right:10px; font-size:32px; color:red; cursor:pointer;">×</span>
          <img alt="معلومات" src="https://i.ibb.co/Xr0rms0C/ff.webp" style="max-width:100%; max-height:80vh; display:block; margin:auto;"/>
        </div>
      </div>

        <div id="myOffersContainer"></div>

        <div id="selected-amount-container" style="
          margin:20px auto; max-width:400px; padding:20px; text-align:center;
          border:2px solid #007bff; border-radius:10px; background-color:#f9f9f9; font-weight:bold;">
          <h2> المبلغ المطلوب : </h2>
          <div class="voucher"><span id="selected-amount">لم يتم اختيار عرض شحن</span></div>
        </div>

        <!-- ✅ Turnstile -->
        <div class="cf-turnstile" data-sitekey="0x4AAAAAABsSmtYb9Jz6DrPC" data-theme="light"></div>

        <button class="send-button" style="margin-top:20px; padding:10px 20px; font-size:18px; background:#007bff; color:#fff; border:none; border-radius:5px; cursor:pointer;" type="submit">شراء</button>
      </div>
    </div>

    <div style="height: 40px;"></div>
    <div id="footerContainer"></div>
  </form>

  <script>
  // ===== دالة تنسيق الأرقام (K / M / B) =====
  function formatNumber(n) {
    const num = Number(n);
    if (num >= 1e9) return (num / 1e9).toFixed(num % 1e9 ? 1 : 0) + "B";
    if (num >= 1e6) return (num / 1e6).toFixed(num % 1e6 ? 1 : 0) + "M";
    if (num >= 1e3) return (num / 1e3).toFixed(num % 1e3 ? 1 : 0) + "K";
    return String(num);
  }

  // ===== Footer =====
  const footer = document.createElement("footer");
  footer.className = "footer-icons";
  const footerTitle = document.createElement("h2");
  footerTitle.className = "footer-title";
  footerTitle.textContent = "لماذا تختارنا؟";
  footer.appendChild(footerTitle);
  const iconBoxesData = [
    { iconClass: "fas fa-shipping-fast shipping-icon", title: "شحن سريع", desc: "يتميز متجرنا بسرعته الفائقة بالشحن فبمجرد أن تطلب سيتم الشحن لك مباشرة" },
    { iconClass: "fas fa-lock", title: "آمن 100%", desc: "حماية كاملة للبيانات والمعاملات" },
    { iconClass: "fas fa-headset", title: "دعم فني مستمر", desc: "دعم فني مستمر لمساعدة العملاء عند الحاجة" },
    { iconClass: "fas fa-coins special-icon", title: "اسعار مميزة", desc: "نقدم اسعار اقل من اسعار اللعبة" },
    { iconClass: "fas fa-credit-card", title: "سهولة الدفع", desc: "طرق دفع عديدة" },
    { iconClass: "fas fa-shield-alt", title: "ضمان على الشحن", desc: "احصل على كامل المبلغ مع تعويض في حالة عدم وصول الشحنه" },
    { iconClass: "fas fa-sync-alt", title: "تحديثات مستمرة", desc: "نقوم بحل جميع المشاكل بشكل دوري" },
    { iconClass: "fas fa-tasks", title: "تعقب الطلبات", desc: "يمكنك رؤية حالة الطلبات الخاص بك من تبويب طلباتي" },
    { iconClass: "fas fa-undo", title: "الغاء الطلبات", desc: "يمكنك الغاء اي طلب قبل اتمام عملية الدفع عبر التواصل مع الدعم الفني" },
    { iconClass: "fas fa-server", title: "تخزين للطلبات", desc: "يتم وضع الطلبات في سيرفرات لعدم فقدانها تحت اي ضرف" }
  ];
  iconBoxesData.forEach(({ iconClass, title, desc }) => {
    const box = document.createElement("div");
    box.className = "icon-box";
    const icon = document.createElement("i"); icon.className = iconClass; box.appendChild(icon);
    const h3 = document.createElement("h3"); h3.textContent = title; box.appendChild(h3);
    const p = document.createElement("p"); p.textContent = desc; box.appendChild(p);
    footer.appendChild(box);
  });

  // ===== بطاقات العروض =====
  function createOfferBox({ type, tokens, offer, imgSrc, imgAlt }) {
    const div = document.createElement("div");
    div.className = "offer-box";
    div.dataset.type = type;
    if (tokens) div.dataset.tokens = tokens;
    if (offer) div.dataset.offer = offer;
    div.onclick = function () { toggleOffer(this); };
    const img = document.createElement("img");
    img.src = imgSrc; img.alt = imgAlt;
    img.loading = 'lazy'; img.decoding = 'async'; img.setAttribute('fetchpriority','low');
    div.appendChild(img);
    const span = document.createElement("span"); 
    // *** تعديل العرض ليظهر بصيغة مختصرة ***
    span.textContent = tokens ? `${formatNumber(tokens)} $` : offer; 
    div.appendChild(span);
    return div;
  }

  const offersBox = document.createElement("div"); offersBox.className = "offers-box";
  const label = document.createElement("label"); label.textContent = "اختر عرض الشحن 🎁"; offersBox.appendChild(label);
  const topupOffers = [
    { tokens: 10, imgSrc: "https://m.media-amazon.com/images/I/71nvKD9L-iL._UF1000,1000_QL80_.jpg", imgAlt: "10$" }
  ];
  topupOffers.forEach(offer => { offersBox.appendChild(createOfferBox({ type: "topup", tokens: offer.tokens, imgSrc: offer.imgSrc, imgAlt: offer.imgAlt })); });
  const membershipOffersGrid = document.createElement("div"); membershipOffersGrid.id = "membership-offers"; membershipOffersGrid.className = "offers-grid"; membershipOffersGrid.style.justifyContent = "center";
  const membershipOffers = [

  ];
  membershipOffers.forEach(offer => { membershipOffersGrid.appendChild(createOfferBox({ type: "membership", offer: offer.offer, imgSrc: offer.imgSrc, imgAlt: offer.imgAlt })); });
  offersBox.appendChild(membershipOffersGrid);

  window.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById("myOffersContainer");
    if (container) container.appendChild(offersBox);
    // ✅ اربط الفورم بـ sendOrder ومنع إعادة التحميل
    const form = document.getElementById('orderForm');
    if (form) {
      form.addEventListener('submit', function(e){
        e.preventDefault();
        if (typeof sendOrder === 'function') sendOrder();
      });
    }
  });

  // ===== (أُزيل السطر العائم الذي كان يسبب الخطأ) =====
  // span.textContent = tokens ? `${formatNumber(tokens)} $` : offer;

  // ===== حساب السعر وعرضه =====
  function toggleOffer(element) {
    if (element.classList.contains("disabled")) { 
      showToast("غير متوفر", "warning"); 
      return; 
    }

    // ✅ إلغاء تحديد جميع العروض الأخرى
    document.querySelectorAll('.offer-box.selected').forEach(el => {
      el.classList.remove('selected');
    });

    // ✅ تحديد العنصر الحالي فقط
    element.classList.add("selected");

    const selectedOffers = [{
      type: element.dataset.type,
      tokens: element.dataset.tokens || null,
      offerName: element.dataset.offer || null
    }];

    // ✅ قراءة الأسعار من localStorage
    const raw = JSON.parse(localStorage.getItem("offersPrices") || "{}");
    const offersPrices = raw.prices || raw;

    let total = 0; 
    const breakdownLines = [];
    const key = element.dataset.tokens ? `${element.dataset.tokens}_tokens` : element.dataset.offer;
    const price = offersPrices[key];
    if (price !== undefined) {
      total += Number(price);
      // *** إظهار الاسم بصيغة مختصرة أيضًا ***
      const nameText  = element.dataset.tokens ? `${formatNumber(element.dataset.tokens)} $` : element.dataset.offer;
      const priceText = `${Number(price).toFixed(2)} د.أ`;
      breakdownLines.push(
        `<span class="item-name">${nameText}</span> : <span class="item-price">${priceText}</span>`
      );

    } else {
      breakdownLines.push(`• ${element.dataset.tokens || element.dataset.offer}: ❓ غير معروف`);
    }

    const el = document.getElementById("selected-amount");

    if (breakdownLines.length === 0) {
      // لا يوجد أي عنصر مختار
      el.textContent = "لم يتم اختيار عرض شحن";
      el.classList.add("no-selection");
    } else {
      // يوجد عناصر مختارة
      el.innerHTML = `${breakdownLines.join("<br>")}<br><br><strong>المجموع: ${total.toFixed(2)} د.أ</strong>`;
      el.classList.remove("no-selection");
    }
  }

  // ===== Toast =====
  function showToast(message, type = "info", duration = 4000) {
    const toast = document.getElementById("toast");
    const toastMessage = document.getElementById("toast-message");
    if (!toast || !toastMessage) return;
    let icon = type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️';
    toastMessage.innerHTML = `<span style="margin-right:8px;">${icon}</span>${message}`;
    toast.style.background = type === 'success' ? 'linear-gradient(135deg, #28a745, #218838)'
                          : type === 'error'   ? 'linear-gradient(135deg, #dc3545, #b52a38)'
                          : type === 'warning' ? 'linear-gradient(135deg, #ffc107, #e0a800)'
                                               : 'linear-gradient(135deg, #17a2b8, #117a8b)';
    toast.style.color = '#fff'; toast.style.padding = '14px 20px'; toast.style.borderRadius = '10px';
    toast.style.fontSize = '16px'; toast.style.fontWeight = 'bold'; toast.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
    toast.style.display = 'flex'; toast.style.alignItems = 'center'; toast.style.gap = '10px';
    toast.style.transform = 'translateY(100px)'; toast.style.opacity = '0'; toast.style.visibility = 'visible'; toast.style.transition = 'all 0.5s ease';
    setTimeout(() => { toast.style.transform = 'translateY(0)'; toast.style.opacity = '1'; }, 50);
    setTimeout(() => { toast.style.transform = 'translateY(100px)'; toast.style.opacity = '0'; setTimeout(() => { toast.style.visibility = 'hidden'; }, 500); }, duration);
  }

  // ===== تهيئة بطاقات التفعيل/التعطيل من Firestore =====
  firebase.auth().onAuthStateChanged(async (user) => {
    if (user) {
      const userDocRef = firebase.firestore().collection("users").doc(user.uid);
      const snap = await userDocRef.get();
      if (snap.exists) {
        const userData = snap.data();
        const nameInput = document.getElementById("userName");
        if (nameInput) {
          nameInput.value = userData.username || "";
          nameInput.readOnly = true;
          nameInput.style.backgroundColor = "#e9ecef";
          nameInput.style.cursor = "not-allowed";
        }
      }
    } else {
      location.href = "main.html";
    }
  });

  document.addEventListener("DOMContentLoaded", async () => {
    try {
      const stateDoc = await firebase.firestore().collection("freefire").doc("state").get();
      if (stateDoc.exists) {
        const stateData = stateDoc.data();
        Object.entries(stateData.topup || {}).forEach(([tokens, status]) => {
          const card = document.querySelector(`.offer-box[data-type="topup"][data-tokens="${tokens}"]`);
          if (card) { card.classList.toggle('disabled', status === 'off'); card.style.opacity = status === 'off' ? '0.4' : '1'; }
        });
        Object.entries(stateData.membership || {}).forEach(([offerName, status]) => {
          const card = document.querySelector(`.offer-box[data-type="membership"][data-offer="${offerName}"]`);
          if (card) { card.classList.toggle('disabled', status === 'off'); card.style.opacity = status === 'off' ? '0.4' : '1'; }
        });
      } else {
        console.warn("⚠️ لم يتم العثور على وثيقة الحالة في Firestore");
      }
    } catch (e) { console.error("❌ فشل في جلب حالة العروض:", e); }
  });
  </script>
 </body>
</html>








